<?xml version="1.0" encoding="ISO-8859-1"?>

<bugs>
	<bug>
		<id>326</id>
		<title>针对 Overlay 相关组件增加、删除遇见的一些问题</title>
		<body>## 需求说明  1. 在地图上点击一下添加一个 `Marker`，点击已存在的 `Marker` 删除它。 2. 两个 `Marker` 用线连接。  ## 基础代码  ```jsx import React from "react"; import { View } from "react-native"; import { MapView, Overlay } from "react-native-baidu-map";  const getPointKey = l =&gt; `${l.latitude}_${l.longitude}`;  class Demo extends React.Component {   constructor(props) {     super(props);      this.state = {       markLocations: []     };   }    onMapClick = e =&gt; {     this.setState({       markLocations: this.state.markLocations.concat(e)     });   };    onMarkerClick = ({ position }) =&gt; {     this.setState({       markLocations: this.state.markLocations.filter(         l =&gt;           l.latitude !== position.latitude || l.longitude !== position.longitude       )     });   };    render() {     const { markLocations } = this.state;      return (       &lt;MapView         style={{ flex: 1 }}         onMapClick={this.onMapClick}         onMarkerClick={this.onMarkerClick}       &gt;         {markLocations.map(_location =&gt; {           return (             &lt;Overlay.Marker               key={getPointKey(_location)}               location={_location}               icon={require("./img/marker-drag.png")}             /&gt;           );         })}          {/* 如果这里不套一个 View，初次打开页面会报错，大概是 null 不能是子组件 */}         {/* 优化一下？ */}         &lt;View&gt;           {markLocations.length &gt;= 2 ? (             &lt;Overlay.Polyline               lineWidth={6}               strokeColor="FF727cf5"               points={markLocations}             /&gt;           ) : null}         &lt;/View&gt;       &lt;/MapView&gt;     );   } } ```  ## 问题/反馈  ### 只有 `Marker`  添加/删除看起来没有问题  ### `Marker` 和 `Polyline` 共存  一直添加显示正常。  删除会有问题：  问题一：  1. 在地图上点击四下，有四个 `Marker`，两个之间按顺序通过 `Polyline` 连接起来； 2. 删除最后一个 `Marker` 地图上会显示倒数第二个 `Marker` 消失，最后一个保留，`Polyline` 显示正常，后面三个点连起来的； 3. 删除地图上显示的倒数第一个点（逻辑数据上倒数第二个），正确消失，上面最后一个点依旧显示，`Polyline` 显示正常，   问题二：  1. 在地图上点击四下，有四个 `Marker`，两个之间按顺序通过 `Polyline` 连接起来； 2. 删除倒数第二个点，所有的 `Marker` 都还在，`Polyline` 全部消失； 3. 再次点击添加 `Marker` 能添加，`Polyline` 不再显示；  问题三：  偶尔在删除 `Marker` 的时候回触发红屏保存。  问题四：  ```js const getIntermediatePoint = (a, b) =&gt; {   return {     longitude: (a.longitude + b.longitude) / 2,     latitude: (a.latitude + b.latitude) / 2,   }; }; ```  ```jsx &lt;View&gt;   {markLocations.length &gt;= 2 ? (     &lt;Overlay.Polyline       lineWidth={6}       strokeColor="FF727cf5"       points={markLocations}     /&gt;   ) : null} &lt;/View&gt;  {/* 替换成下面的 */} &lt;View&gt;   {markLocations.length &gt;= 2     ? markLocations.map((_location, i) =&gt; {         if (i === 0) {           return null;         }          return (           &lt;Overlay.Marker             key={getPointKey(_location)}             location={getIntermediatePoint(_location, markLocations[i - 1])}             icon={require('../../assets/bmap/marker1.png')}           /&gt;         );       })     : null} &lt;/View&gt; ```  同一个种类的 `Marker` 显示也有问题，可能中间某个就不见了。  ## 设备  * 手机：魅族 16th * Android 版本：8.1.0 * Flyme 版本：8.0.0.0A * React Native: 0.61.5 * 开发机器：macOS Catalina 10.15.3  </body>
		<created>2020-02-23 12:13:45</created>
		<closed>2020-05-17 15:22:52</closed>
	</bug>
	<bug>
		<id>285</id>
		<title>Android: 简单的地图视图导致闪退</title>
		<body>JSX: ``` &lt;MapView     width={width}     height={400}     zoom={13}    trafficEnabled={true}    zoomControlsVisible={true}    mapType={MapTypes.NORMAL}    center={{ longitude: 113.950453, latitude: 22.546045 }} &gt;   &lt;Overlay.Marker location={{ longitude: 113.969453, latitude: 22.530045 }} /&gt; &lt;/MapView&gt; ```  Android Studio 抓到的，以 `baidu` 过滤出来的错误信息： ``` 10-21 15:02:20.426 18824-18824/net.ceo100.drp E/unknown:ViewManager: Error while updating prop center     java.lang.reflect.InvocationTargetException         at java.lang.reflect.Method.invoke(Native Method)         at com.facebook.react.uimanager.ViewManagersPropertyCache$PropSetter.updateViewProp(ViewManagersPropertyCache.java:83)         at com.facebook.react.uimanager.ViewManagerPropertyUpdater$FallbackViewManagerSetter.setProperty(ViewManagerPropertyUpdater.java:132)         at com.facebook.react.uimanager.ViewManagerPropertyUpdater.updateProps(ViewManagerPropertyUpdater.java:51)         at com.facebook.react.uimanager.ViewManager.updateProperties(ViewManager.java:37)         at com.facebook.react.uimanager.NativeViewHierarchyManager.createView(NativeViewHierarchyManager.java:265)         at com.facebook.react.uimanager.UIViewOperationQueue$CreateViewOperation.execute(UIViewOperationQueue.java:200)         at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.dispatchPendingNonBatchedOperations(UIViewOperationQueue.java:1109)         at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.doFrameGuarded(UIViewOperationQueue.java:1080)         at com.facebook.react.uimanager.GuardedFrameCallback.doFrame(GuardedFrameCallback.java:29)         at com.facebook.react.modules.core.ReactChoreographer$ReactChoreographerDispatcher.doFrame(ReactChoreographer.java:166)         at com.facebook.react.modules.core.ChoreographerCompat$FrameCallback$1.doFrame(ChoreographerCompat.java:84)         at android.view.Choreographer$CallbackRecord.run(Choreographer.java:894)         at android.view.Choreographer.doCallbacks(Choreographer.java:698)         at android.view.Choreographer.doFrame(Choreographer.java:630)         at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:882)         at android.os.Handler.handleCallback(Handler.java:815)         at android.os.Handler.dispatchMessage(Handler.java:104)         at android.os.Looper.loop(Looper.java:207)         at android.app.ActivityThread.main(ActivityThread.java:5845)         at java.lang.reflect.Method.invoke(Native Method)         at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:907)         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:768)      Caused by: java.lang.NoSuchMethodError: No interface method putMap(Ljava/lang/String;Lcom/facebook/react/bridge/ReadableMap;)V in class Lcom/facebook/react/bridge/WritableMap; or its super classes (declaration of 'com.facebook.react.bridge.WritableMap' appears in /data/app/net.ceo100.drp-2/base.apk)         at org.lovebing.reactnative.baidumap.listener.MapListener.getEventParams(MapListener.java:118)         at org.lovebing.reactnative.baidumap.listener.MapListener.onMapStatusChange(MapListener.java:82)         at com.baidu.mapapi.map.BaiduMap.setMapStatus(Unknown Source)         at org.lovebing.reactnative.baidumap.uimanager.MapViewManager.setCenter(MapViewManager.java:120)         at java.lang.reflect.Method.invoke(Native Method)          at com.facebook.react.uimanager.ViewManagersPropertyCache$PropSetter.updateViewProp(ViewManagersPropertyCache.java:83)          at com.facebook.react.uimanager.ViewManagerPropertyUpdater$FallbackViewManagerSetter.setProperty(ViewManagerPropertyUpdater.java:132)          at com.facebook.react.uimanager.ViewManagerPropertyUpdater.updateProps(ViewManagerPropertyUpdater.java:51)          at com.facebook.react.uimanager.ViewManager.updateProperties(ViewManager.java:37)          at com.facebook.react.uimanager.NativeViewHierarchyManager.createView(NativeViewHierarchyManager.java:265)          at com.facebook.react.uimanager.UIViewOperationQueue$CreateViewOperation.execute(UIViewOperationQueue.java:200)          at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.dispatchPendingNonBatchedOperations(UIViewOperationQueue.java:1109)          at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.doFrameGuarded(UIViewOperationQueue.java:1080)          at com.facebook.react.uimanager.GuardedFrameCallback.doFrame(GuardedFrameCallback.java:29)          at com.facebook.react.modules.core.ReactChoreographer$ReactChoreographerDispatcher.doFrame(ReactChoreographer.java:166)          at com.facebook.react.modules.core.ChoreographerCompat$FrameCallback$1.doFrame(ChoreographerCompat.java:84)          at android.view.Choreographer$CallbackRecord.run(Choreographer.java:894)          at android.view.Choreographer.doCallbacks(Choreographer.java:698)          at android.view.Choreographer.doFrame(Choreographer.java:630)          at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:882)          at android.os.Handler.handleCallback(Handler.java:815)          at android.os.Handler.dispatchMessage(Handler.java:104)          at android.os.Looper.loop(Looper.java:207)          at android.app.ActivityThread.main(ActivityThread.java:5845)          at java.lang.reflect.Method.invoke(Native Method)          at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:907)          at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:768)  10-21 15:02:20.427 18824-18824/net.ceo100.drp E/unknown:ReactNative: Exception in native call     com.facebook.react.bridge.JSApplicationIllegalArgumentException: Error while updating property 'center' of a view managed by: BaiduMapView         at com.facebook.react.uimanager.ViewManagersPropertyCache$PropSetter.updateViewProp(ViewManagersPropertyCache.java:95)         at com.facebook.react.uimanager.ViewManagerPropertyUpdater$FallbackViewManagerSetter.setProperty(ViewManagerPropertyUpdater.java:132)         at com.facebook.react.uimanager.ViewManagerPropertyUpdater.updateProps(ViewManagerPropertyUpdater.java:51)         at com.facebook.react.uimanager.ViewManager.updateProperties(ViewManager.java:37)         at com.facebook.react.uimanager.NativeViewHierarchyManager.createView(NativeViewHierarchyManager.java:265)         at com.facebook.react.uimanager.UIViewOperationQueue$CreateViewOperation.execute(UIViewOperationQueue.java:200)         at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.dispatchPendingNonBatchedOperations(UIViewOperationQueue.java:1109)         at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.doFrameGuarded(UIViewOperationQueue.java:1080)         at com.facebook.react.uimanager.GuardedFrameCallback.doFrame(GuardedFrameCallback.java:29)         at com.facebook.react.modules.core.ReactChoreographer$ReactChoreographerDispatcher.doFrame(ReactChoreographer.java:166)         at com.facebook.react.modules.core.ChoreographerCompat$FrameCallback$1.doFrame(ChoreographerCompat.java:84)         at android.view.Choreographer$CallbackRecord.run(Choreographer.java:894)         at android.view.Choreographer.doCallbacks(Choreographer.java:698)         at android.view.Choreographer.doFrame(Choreographer.java:630)         at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:882)         at android.os.Handler.handleCallback(Handler.java:815)         at android.os.Handler.dispatchMessage(Handler.java:104)         at android.os.Looper.loop(Looper.java:207)         at android.app.ActivityThread.main(ActivityThread.java:5845)         at java.lang.reflect.Method.invoke(Native Method)         at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:907)         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:768)      Caused by: java.lang.reflect.InvocationTargetException         at java.lang.reflect.Method.invoke(Native Method)         at com.facebook.react.uimanager.ViewManagersPropertyCache$PropSetter.updateViewProp(ViewManagersPropertyCache.java:83)         at com.facebook.react.uimanager.ViewManagerPropertyUpdater$FallbackViewManagerSetter.setProperty(ViewManagerPropertyUpdater.java:132)          at com.facebook.react.uimanager.ViewManagerPropertyUpdater.updateProps(ViewManagerPropertyUpdater.java:51)          at com.facebook.react.uimanager.ViewManager.updateProperties(ViewManager.java:37)          at com.facebook.react.uimanager.NativeViewHierarchyManager.createView(NativeViewHierarchyManager.java:265)          at com.facebook.react.uimanager.UIViewOperationQueue$CreateViewOperation.execute(UIViewOperationQueue.java:200)          at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.dispatchPendingNonBatchedOperations(UIViewOperationQueue.java:1109)          at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.doFrameGuarded(UIViewOperationQueue.java:1080)          at com.facebook.react.uimanager.GuardedFrameCallback.doFrame(GuardedFrameCallback.java:29)          at com.facebook.react.modules.core.ReactChoreographer$ReactChoreographerDispatcher.doFrame(ReactChoreographer.java:166)          at com.facebook.react.modules.core.ChoreographerCompat$FrameCallback$1.doFrame(ChoreographerCompat.java:84)          at android.view.Choreographer$CallbackRecord.run(Choreographer.java:894)          at android.view.Choreographer.doCallbacks(Choreographer.java:698)          at android.view.Choreographer.doFrame(Choreographer.java:630)          at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:882)          at android.os.Handler.handleCallback(Handler.java:815)          at android.os.Handler.dispatchMessage(Handler.java:104)          at android.os.Looper.loop(Looper.java:207)          at android.app.ActivityThread.main(ActivityThread.java:5845)          at java.lang.reflect.Method.invoke(Native Method)          at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:907)          at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:768)       Caused by: java.lang.NoSuchMethodError: No interface method putMap(Ljava/lang/String;Lcom/facebook/react/bridge/ReadableMap;)V in class Lcom/facebook/react/bridge/WritableMap; or its super classes (declaration of 'com.facebook.react.bridge.WritableMap' appears in /data/app/net.ceo100.drp-2/base.apk)         at org.lovebing.reactnative.baidumap.listener.MapListener.getEventParams(MapListener.java:118)         at org.lovebing.reactnative.baidumap.listener.MapListener.onMapStatusChange(MapListener.java:82)         at com.baidu.mapapi.map.BaiduMap.setMapStatus(Unknown Source)         at org.lovebing.reactnative.baidumap.uimanager.MapViewManager.setCenter(MapViewManager.java:120)         at java.lang.reflect.Method.invoke(Native Method)          at com.facebook.react.uimanager.ViewManagersPropertyCache$PropSetter.updateViewProp(ViewManagersPropertyCache.java:83)          at com.facebook.react.uimanager.ViewManagerPropertyUpdater$FallbackViewManagerSetter.setProperty(ViewManagerPropertyUpdater.java:132)          at com.facebook.react.uimanager.ViewManagerPropertyUpdater.updateProps(ViewManagerPropertyUpdater.java:51)          at com.facebook.react.uimanager.ViewManager.updateProperties(ViewManager.java:37)          at com.facebook.react.uimanager.NativeViewHierarchyManager.createView(NativeViewHierarchyManager.java:265)          at com.facebook.react.uimanager.UIViewOperationQueue$CreateViewOperation.execute(UIViewOperationQueue.java:200)          at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.dispatchPendingNonBatchedOperations(UIViewOperationQueue.java:1109)          at com.facebook.react.uimanager.UIViewOperationQueue$DispatchUIFrameCallback.doFrameGuarded(UIViewOperationQueue.java:1080)          at com.facebook.react.uimanager.GuardedFrameCallback.doFrame(GuardedFrameCallback.java:29)          at com.facebook.react.modules.core.ReactChoreographer$ReactChoreographerDispatcher.doFrame(ReactChoreographer.java:166)          at com.facebook.react.modules.core.ChoreographerCompat$FrameCallback$1.doFrame(ChoreographerCompat.java:84)          at android.view.Choreographer$CallbackRecord.run(Choreographer.java:894)          at android.view.Choreographer.doCallbacks(Choreographer.java:698)          at android.view.Choreographer.doFrame(Choreographer.java:630)          at android.view.Choreographer$FrameDisplayEventReceiver.run(Choreographer.java:882)          at android.os.Handler.handleCallback(Handler.java:815)          at android.os.Handler.dispatchMessage(Handler.java:104)          at android.os.Looper.loop(Looper.java:207)          at android.app.ActivityThread.main(ActivityThread.java:5845)          at java.lang.reflect.Method.invoke(Native Method)          at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:907)          at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:768)  10-21 15:02:20.443 18824-18824/net.ceo100.drp E/AndroidRuntime: FATAL EXCEPTION: main     Process: net.ceo100.drp, PID: 18824     java.lang.NoSuchMethodError: No interface method putMap(Ljava/lang/String;Lcom/facebook/react/bridge/ReadableMap;)V in class Lcom/facebook/react/bridge/WritableMap; or its super classes (declaration of 'com.facebook.react.bridge.WritableMap' appears in /data/app/net.ceo100.drp-2/base.apk)         at org.lovebing.reactnative.baidumap.listener.MapListener.getEventParams(MapListener.java:118)         at org.lovebing.reactnative.baidumap.listener.MapListener.onMapStatusChangeFinish(MapListener.java:90)         at com.baidu.mapapi.map.c.c(Unknown Source)         at com.baidu.mapsdkplatform.comapi.map.e.B(Unknown Source)         at com.baidu.mapsdkplatform.comapi.map.m.handleMessage(Unknown Source)         at android.os.Handler.dispatchMessage(Handler.java:111)         at android.os.Looper.loop(Looper.java:207)         at android.app.ActivityThread.main(ActivityThread.java:5845)         at java.lang.reflect.Method.invoke(Native Method)         at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:907)         at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:768) ```  @lovebing  可以看出来是什么原因吗？  谢谢。</body>
		<created>2019-10-21 07:06:59</created>
		<closed>2019-10-31 16:30:46</closed>
	</bug>
</bugs>
